@using Shared.DTOs
@model ProductDTO

@{
    ViewData["Title"] = "ProductDetail";
    Layout = "~/Views/Shared/_Layout.cshtml";
}

<div class="container mt-5">
    <form asp-controller="Cart" asp-action="AddToCart" method="post">
        <input type="hidden" asp-for="ProductId" />
        <input type="hidden" name="productVariantId" value="@Model.ProductVariants.FirstOrDefault().ProductVariantId" />
        <div class="row">
            <div class="col">
                <img src="~/images/Space Cadet.jpg" style="background-color: rgb(246, 246, 246);" class="card-img-top"
                    alt="...">
            </div>
            <div class="col">
                <h1 id="productName">@Model.Name</h1>
                <h3 id="productPrice">$@Model.ProductVariants.FirstOrDefault().Price</h3>
                <h4 id="productTaste">@Model.ProductVariants.FirstOrDefault().Taste</h4>
                <p>@Html.DisplayFor(model => model.Description)</p>
                <label for="inputPassword5" class="form-label">Size</label>
                <select name="productVariantId" class="form-select form-select-lg mb-3"
                    aria-label="Large select example" id="variantSelect" onchange="updateVariant()">
                    @for (var i = 0; i < Model.ProductVariants.Count(); i++)
                    {
                        <option value="@Model.ProductVariants[i].ProductVariantId">@Model.ProductVariants[i].Size</option>
                    }
                </select>
                <div class="mb-3">
                    <label for="inputPassword5" class="form-label">Quantity</label>
                    <div class="input-group" style="width: 120px;">
                        <button class="minus is-form btn btn-outline-secondary" type="button" value="-">-</button>
                        <input asp-for="quantity" aria-label="quantity" class="input-qty" type="text" placeholder="1"
                            max="99" min="1" style=" width: 3rem; text-align: center;" value="1">
                        <button class="plus is-form btn btn-outline-secondary" type="button" value="+">+</button>
                    </div>
                </div>
                <div class="d-grid">
                    <button class="btn btn-danger btn-lg mt-3" type="submit">Add to Cart</button>
                </div>

                <hr class="featurette-divider mt-5 mb-4">

                <div class="accordion" id="accordionPanelsStayOpenExample">
                    <h1 class="accordion-header">
                        <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse"
                            data-bs-target="#panelsStayOpen-collapseTwo" aria-expanded="false"
                            aria-controls="panelsStayOpen-collapseTwo">
                            <h3>Flavor Profile</h3>
                        </button>
                    </h1>

                    <div id="panelsStayOpen-collapseTwo" class="accordion-collapse collapse">
                        <div class="accordion-body">
                            <div>
                                <h4>Roast Level</h4>
                                <p style="font-size: 24px;"><i class="bi bi-fire"></i><span
                                        id="roastLevel">@Model.ProductVariants.FirstOrDefault().RoastType</span></p>
                                <h4>Origin</h4>
                                <p style="font-size: 24px;"><i class="bi bi-globe-americas"></i><span
                                        id="originRegion">@Model.ProductVariants.FirstOrDefault().Region</span></p>
                                </p>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="accordion" id="accordionPanelsStayOpenExample">
                    <h1 class="accordion-header">
                        <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse"
                            data-bs-target="#panelsStayOpen-collapseTwo2" aria-expanded="false"
                            aria-controls="panelsStayOpen-collapseTwo2">
                            <h3>Why Yang's Coffee?</h3>
                        </button>
                    </h1>

                    <div id="panelsStayOpen-collapseTwo2" class="accordion-collapse collapse">
                        <div class="accordion-body">
                            <div>
                                <p>We are a small family business that has been roasting coffee for over 20 years. We
                                    take
                                    pride
                                    in our craft and are committed to providing the best quality coffee to our
                                    customers.
                                </p>
                                <p>Our coffee is sourced from the best farms around the world and roasted to perfection
                                    in
                                    small
                                    batches. We believe that great coffee should be accessible to everyone, and we
                                    strive to
                                    make our products affordable without compromising on quality.</p>
                                <p>Thank you for supporting our small business. We hope you enjoy our coffee as much as
                                    we
                                    do!
                                </p>
                            </div>

                        </div>
                    </div>
                </div>
            </div>
        </div>
    </form>


    <div class="container my-5">
        <!-- Section Heading -->
        <h2 class="mb-4">Top roast coffee collection</h2>

        <!-- Carousel -->
        <div id="coffeeCarousel" class="carousel slide" data-bs-ride="carousel">
            <!-- Carousel Inner -->
            <div class="carousel-inner">
                <div class="carousel-item active">
                    <div class="row">
                        <!-- Product 1 -->
                        <div class="col-md-3">
                            <div class="card border-0" style="width: 100%;">
                                <img src="/images/Space Cadet.jpg" style="background-color: rgb(246, 246, 246);"
                                    class="card-img-top" alt="Space Cadet Coffee Bag">
                                <div class="card-body p-0 mt-3">
                                    <div class="d-flex align-items-center justify-content-between">
                                        <h5 class="card-title mb-1 fw-bold">Space Cadet</h5>
                                        <h5 class="card-text fw-bold">$15.75</h5>
                                    </div>
                                    <p class="card-text text-muted mb-2">Sweet & Smooth</p>
                                </div>
                                <button class="btn btn-danger btn-lg" type="button">Add to Cart</button>
                            </div>
                        </div>
                        <!-- Product 2 -->
                        <div class="col-md-3">
                            <div class="card border-0" style="width: 100%;">
                                <img src="/images/Space Cadet.jpg" style="background-color: rgb(246, 246, 246);"
                                    class="card-img-top" alt="Space Cadet Coffee Bag">
                                <div class="card-body p-0 mt-3">
                                    <div class="d-flex align-items-center justify-content-between">
                                        <h5 class="card-title mb-1 fw-bold">Space Cadet</h5>
                                        <h5 class="card-text fw-bold">$15.75</h5>
                                    </div>
                                    <p class="card-text text-muted mb-2">Sweet & Smooth</p>
                                </div>
                                <button class="btn btn-danger btn-lg" type="button">Add to Cart</button>
                            </div>
                        </div>
                        <!-- Product 3 -->
                        <div class="col-md-3">
                            <div class="card border-0" style="width: 100%;">
                                <img src="/images/Space Cadet.jpg" style="background-color: rgb(246, 246, 246);"
                                    class="card-img-top" alt="Space Cadet Coffee Bag">
                                <div class="card-body p-0 mt-3">
                                    <div class="d-flex align-items-center justify-content-between">
                                        <h5 class="card-title mb-1 fw-bold">Space Cadet</h5>
                                        <h5 class="card-text fw-bold">$15.75</h5>
                                    </div>
                                    <p class="card-text text-muted mb-2">Sweet & Smooth</p>
                                </div>
                                <button class="btn btn-danger btn-lg" type="button">Add to Cart</button>
                            </div>
                        </div>
                        <!-- Product 4 -->
                        <div class="col-md-3">
                            <div class="card border-0" style="width: 100%;">
                                <img src="/images/Space Cadet.jpg" style="background-color: rgb(246, 246, 246);"
                                    class="card-img-top" alt="Space Cadet Coffee Bag">
                                <div class="card-body p-0 mt-3">
                                    <div class="d-flex align-items-center justify-content-between">
                                        <h5 class="card-title mb-1 fw-bold">Space Cadet</h5>
                                        <h5 class="card-text fw-bold">$15.75</h5>
                                    </div>
                                    <p class="card-text text-muted mb-2">Sweet & Smooth</p>
                                </div>
                                <button class="btn btn-danger btn-lg" type="button">Add to Cart</button>
                            </div>
                        </div>
                    </div>
                </div>
                <!-- Add more carousel items if needed -->
            </div>

            <!-- Carousel Controls -->
            <button class="carousel-control-prev" type="button" data-bs-target="#coffeeCarousel" data-bs-slide="prev">
                <span class="carousel-control-prev-icon" aria-hidden="true"></span>
                <span class="visually-hidden">Previous</span>
            </button>
            <button class="carousel-control-next" type="button" data-bs-target="#coffeeCarousel" data-bs-slide="next">
                <span class="carousel-control-next-icon" aria-hidden="true"></span>
                <span class="visually-hidden">Next</span>
            </button>
        </div>
    </div>

</div>

@section Scripts {
    @{
        await Html.RenderPartialAsync("_ValidationScriptsPartial");
    }
    <script>
        const productVariants = @Html.Raw(System.Text.Json.JsonSerializer.Serialize(Model.ProductVariants));

        function updateVariant() {
            const selectedId = document.getElementById('variantSelect').value;
            console.log('Selected variant ID:', selectedId);

            const selectedVariant = productVariants.find(variant => variant.ProductVariantId == selectedId);
            console.log('Selected variant object:', selectedVariant);

            if (selectedVariant) {
                document.querySelector('input[name="productVariantId"]').value = selectedVariant.ProductVariantId;
                document.getElementById('productPrice').innerText = "$" + selectedVariant.Price;
                document.getElementById('productTaste').innerText = selectedVariant.Taste;
                document.getElementById('roastLevel').innerText = selectedVariant.RoastType.ToString();
                document.getElementById('originRegion').innerText = selectedVariant.Region.ToString();
            } else {
                console.error('Variant not found for selectedId:', selectedId);
            }
        }


        $('input.input-qty').each(function () {
            var $this = $(this),
                qty = $this.parent().find('.is-form'),
                min = Number($this.attr('min')),
                max = Number($this.attr('max'))
            if (min == 0) {
                var d = 0
            } else d = min
            $(qty).on('click', function () {
                if ($(this).hasClass('minus')) {
                    if (d > min) d += -1
                } else if ($(this).hasClass('plus')) {
                    var x = Number($this.val()) + 1
                    if (x <= max) d += 1
                }
                $this.attr('value', d).val(d)
            })
        })
    </script>
}
